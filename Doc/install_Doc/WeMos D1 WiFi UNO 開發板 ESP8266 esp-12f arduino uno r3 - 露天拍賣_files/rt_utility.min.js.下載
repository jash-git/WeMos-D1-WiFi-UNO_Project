window.RT=window.RT||{},function(t,e){function i(t,i,r){this.el=t,this.$el=e(t),this.bound_dispatcher=this.dispatcher.bind(this),this.callback=RT.Utility.debounce(i,100),this.$el.on("touchstart",this.bound_dispatcher),this.$el.on("mousedown",this.bound_dispatcher),r&&this.$el.on("click",function(t){t.preventDefault()})}function r(t,i){t=t||{},this.$container=e(i?i:window),this.dataAttr=t.dataAttr||"data-src",this.node=t.node||"img",this.excludeClass=t.excludeClass||"loaded",this.imgArray={},this.init()}function n(t,i){this.$container=e(i),this.$scrollNode=this.$container.find(t.scrollNode),!this.$scrollNode.length>0&&(this.$scrollNode=this.$container),this.$list=this.$scrollNode.find(t.listNode),this.$listItem=this.$list.find(t.listItemNode),this.listLength=0,this.showArrow=t.showArrow||!1,this.offset=t.offset||3,this.init()}var o=t.Utility=t.Utility||{};o.getStringLength=function(t){var e=(t.match(/[^\x00-\xff]/g)||"").length;return t.length+e},o.toCommaFormat=function(t){return t=t?t:"--",isNaN(t)?t.toString():t.toString().replace(/^(-?\d+?)((?:\d{3})+)(?=\.\d+$|$)/,function(t,e,i){return e+i.replace(/\d{3}/g,",$&")})},o.setContainerScale=function(t){var i,r,n,o=t.parent().width(),s=this.getMaxWidth(t),h=s>o?o/s:1;h<1&&(n=t.parent(),t.css({transform:"scale("+h+", "+h+")","transform-origin":"0px 0px","-webkit-transform":"scale("+h+", "+h+")","-webkit-transform-origin":"0px 0px",width:s+"px"}),i=Math.round(100*h)/100,i<h&&(i+=.01),r=t[0].offsetHeight*i,n.children().each(function(){this!==t[0]&&(r+=e(this)[0].offsetHeight)}),n.outerHeight(r))},o.getMaxWidth=function(t){var i=t[0].offsetWidth,r=0;return t.children(":not(style, script)").each(function(t){var n=e(this);r=o.getMaxWidth(n),i=Math.max(i,r)}),i},o.transTimeToGo=function(){var t=(new Date).getTime(),e=String.prototype.replace,i={"0s":"馬上","1d":"明天","2d":"後天"},r={sec:{replacement:[/^[0-5]?\d$/,function(t){return i[t+"s"]||t+"秒後"}],divisor:60,next:"min"},min:{replacement:[/^[0-5]?\d$/,"$&分鐘後"],divisor:60,next:"hour"},hour:{replacement:[/^(1?\d|2[0-3])$/,"$&小時後"],divisor:24,next:"day"},day:{replacement:[/^([1-9]|[12]\d|3[01])$/,function(t){return i[t+"d"]||t+"天後"}],divisor:1,next:"end"},end:{replacement:[/^[\d\D]*$/,""]}},n=function(t,i){var o=e.apply(t.toString(),i.replacement);return o==t?n(Math.floor(t/i.divisor),r[i.next]):o};return function(e,i){var o=Math.abs(Math.ceil((t-e)/1e3));return i="function"==typeof i&&i||function(t){return new Date(t).toLocaleString()},n(o,r.sec)||i(e)}}(),o.htmlEntities=function(){var t={"<":"&lt;",">":"&gt;",'"':"&quot;"},e=function(e){return t[e]};return function(t){return"string"==typeof t?t.replace(/[<>"]/g,e):t}}(),o.ie_quote_innerHTML=function(t,e){var i=t.innerHTML?String(t.innerHTML):t,r=i.match(/(<.+[^>])/g);if(r)for(var n=0;n<r.length;n+=1){var o,s=r[n],h=/\=[a-zA-Z\.\:\[\]_\(\)\&\$\%#\@\!0-9\/{}]+[?\s+|?>]/g;if(o=r[n].match(h))for(var a=0,c=o.length;a<c;){var l=/(\=)([a-zA-Z\.\:\[\]_\(\)\&\$\%#\@\!0-9\/{}]+)?([\s+|?>])/g,u=function(){var t=Array.prototype.slice.call(arguments);return'="'+(e?t[2].toLowerCase():t[2])+'"'+t[3]};r[n]=r[n].replace(o[a],o[a].replace(l,u)),a+=1}i=i.replace(s,r[n])}return i},o.Template=function(t,e){var i={_default:o.htmlEntities,html:function(t){return t},nbsp:function(t){return this._default(t).replace(/ /g,"&nbsp;")},br:function(t){return this._default(t).replace(/&lt;br *\/?&gt;/gi,"<br />")},nl2br:function(t){return this._default(t).replace(/\n/g,"<br />")}},r="_rt_tp_"+(new Date).getTime()+"_",n={convert:function(){return arguments[1]}},s=function(i,o,s,h){var a,c=0,l={},u=i.querySelectorAll(o);return!!u.length&&(t.each(u,function(){a=r+c++,this.parentNode.replaceChild(e.createTextNode("{@"+a+"}"),this),this.setAttribute(a,this.getAttribute(s)),this.removeAttribute(s),l[a]=this.outerHTML.replace(new RegExp("\\b"+a+"\\b"),h)}),n.template=i.outerHTML,l)},h=function(r,a){var c,l,u;if(!(this instanceof h))return new h(r,a);for(this.subTemplate={},this.converter={},this.addConverter(i).addConverter(a||{}),"string"==typeof r&&(r="<"===r.charAt(0)?t(r)[0]:e.querySelector(r));c=r.querySelector("[rt-tp]");)l=c.getAttribute("rt-tp"),c.parentNode.replaceChild(e.createTextNode("{#"+l+"}"),c),this.addSubTemplate(l,new h(c));r.parentNode&&r.parentNode.removeChild(r),r.removeAttribute("id"),r.removeAttribute("rt-tp"),u=s(r,"img[tp-src]","tp-src","src"),this.template=this.initTemplate=u?this.html.call(n,u,"$&"):o.ie_quote_innerHTML(r.outerHTML)};return h.prototype.fillStaticModel=function(t){var e=this;return t=void 0===t?{}:t,this.template=this.initTemplate.replace(/\{([@#])(\w+)(?::(\w+))?\}/g,function(i,r,n,o){var s=t[n];return"#"===r?(e.getSubTemplate(n).fillStaticModel(s),"string"==typeof s?e.convert(o,s,t):i):void 0!==s?e.convert(o,s,t):i}),this},h.prototype.addSubTemplate=function(t,e){return this.subTemplate[t]=e,e.parentTemplate=this,this},h.prototype.getSubTemplate=function(t){return this.subTemplate[t]},h.prototype.addConverter=function(e,i){return t.isPlainObject(e)?t.each(e,t.proxy(this,"addConverter")):this.converter[e]=i,this},h.prototype.getConverter=function(t){return this.converter[t]||this.parentTemplate&&this.parentTemplate.getConverter(t)},h.prototype.convert=function(t,e,i){return(this.getConverter(t)||this.converter._default).call(this.converter,e,i)},h.prototype.html=function(e,i){var r=this;return i=void 0===i?"":this.convert("_default",i),this.template.replace(/\{([@#])(\w+)(?::(\w+))?\}/g,function(n,o,s,h){var a=e[s];if(void 0===a)return"$&"===i?n:i;if("#"===o){if(a===!0&&(a={}),t.isPlainObject(a))return r.subTemplate[s].html(a,i);if(t.isArray(a))return t.map(a,function(t,e){return r.subTemplate[s].html(t,i)}).join("")}return r.convert(h,a,e)})},h.prototype.gen=function(e,i){return t(this.html(e,i))},h}(jQuery,document),o.throttle=function(t,e,i){e||(e=250);var r,n;return function(){var o=i||this,s=+new Date,h=arguments;r&&s<r+e?(clearTimeout(n),n=setTimeout(function(){r=s,t.apply(o,h)},e)):(r=s,t.apply(o,h))}},o.debounce=function(t,e){var i=null;return function(){var r=this,n=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(r,n)},e)}},i.prototype.dispatcher=function(t){switch(t.type){case"touchstart":this.start(t);break;case"touchmove":this.move(t);break;case"touchend":this.end(t);break;case"touchcancel":this.cancel(t);break;case"mousedown":this.start(t);break;case"mouseup":this.end(t)}},i.prototype.start=function(t){t=t.originalEvent,this.touched=!0,"touchstart"===t.type?(this.$el.off("mousedown",this.bound_dispatcher),this.$el.on("touchmove touchend touchcancel",this.bound_dispatcher),this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.$el.on("mouseup",this.bound_dispatcher),this.startX=t.clientX,this.startY=t.clientY),this.moved=!1},i.prototype.move=function(t){t=t.originalEvent,(Math.abs(t.changedTouches[0].clientX-this.startX)>10||Math.abs(t.changedTouches[0].clientY-this.startY)>10)&&(this.moved=!0)},i.prototype.end=function(t){return this.$el.off("touchmove touchend touchcancel mouseup",this.bound_dispatcher),!this.moved&&this.touched&&(t.stopPropagation(),this.touched=!1,this.callback.call(this.$el,t)),!1},i.prototype.cancel=function(t){this.moved=!1,this.startX=0,this.startY=0},o.tap=function(t,r){return e(this).each(function(){return new i(this,t,r)})},e.fn.tap=o.tap,r.prototype.init=function(t){var e=this;return this.refreshNode().processImg(),this.$container.off(".lazyLoad").on("scroll.lazyLoad",RT.Utility.throttle(function(){e.processImg()},200)),this},r.prototype.refreshNode=function(){return this.imgArray=Array.prototype.slice.call(e(this.node).not("."+this.excludeClass)),this},r.prototype.renewAttr=function(t){for(key in t)t.hasOwnProperty(key)&&(this[key]=t[key]);return this.refreshNode(),this},r.prototype.processImg=function(){var t=this;return e.each(this.imgArray,function(e,i){t.elementInViewport(i)&&t.loadImage(i,function(){var e=t.imgArray.indexOf(i);e>-1&&t.imgArray.splice(e,1)})}),this},r.prototype.loadImage=function(t,i){var r=new Image,n=t.getAttribute(this.dataAttr),o=this;r.onload=function(){e(t).attr("src",n).addClass(o.excludeClass).hide().fadeIn(),i?i():null},r.src=n},r.prototype.elementInViewport=function(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.top<=(window.innerHeight||document.documentElement.clientHeight)},e.fn.imgLazyLoad=function(t){return new r(t,this)},n.prototype.init=function(){var t=this;this.$listItem.each(function(){t.listLength+=e(this).outerWidth(!0)+t.offset}),this.$list.css("width",t.listLength),this.showArrow&&this.renderArrow()},n.prototype.renderArrow=function(){if(this.$container==this.$scrollNode)return void console.error("Need setting scrollNode");this.$container.prepend('<div class="hlist-left hide rti rti-angle-left"></div>').append('<div class="hlist-right hide rti rti-angle-right"></div>');var t=this;this.windowWidth=e(window).width(),this.$hlistLeft=this.$container.find(".hlist-left"),this.$hlistRight=this.$container.find(".hlist-right"),this.$hlistArrow=this.$hlistRight.add(this.$hlistLeft),this.$container.css("position","relative"),this.$scrollNode.css({"overflow-x":"auto","overflow-y":"hidden"}),this.handleArrow(),e(window).on("resize",function(){t.windowWidth=e(window).width(),t.handleArrow(t)}),this.$scrollNode.on("scroll",RT.Utility.throttle(this.handleArrow.bind(this),50))},n.prototype.handleArrow=function(){var t=this.$scrollNode.scrollLeft(),e=t+this.windowWidth;this.$hlistLeft.toggleClass("hide",0==t),this.$hlistRight.toggleClass("hide",e>=this.listLength)},e.fn.hScrollList=function(t){return new n(t,this)}}(RT,jQuery);